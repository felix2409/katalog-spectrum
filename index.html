<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spectrum ‚Ä¢ Katalog Harga (Laser)</title>
  <style>
    :root{
      --bg:#0b0f17;
      --panel:#101827;
      --card:#0f1a2b;
      --text:#e6edf6;
      --muted:#a8b3c7;
      --accent:#ffd54a;
      --accent2:#56c8ff;
      --ok:#42d39b;
      --danger:#ff5c7a;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background:
        radial-gradient(900px 400px at 15% 0%, rgba(255,213,74,.18), transparent 70%),
        radial-gradient(700px 500px at 85% 0%, rgba(86,200,255,.16), transparent 65%),
        radial-gradient(900px 700px at 50% 110%, rgba(66,211,155,.10), transparent 65%),
        var(--bg);
      min-height:100vh;
    }
    .wrap{max-width:1180px; margin:0 auto; padding:14px 14px 22px;}

    header{display:flex; gap:12px; align-items:flex-start; justify-content:space-between; margin-bottom:12px;}
    .brand{display:flex; gap:12px; align-items:flex-start;}
    .logoImg{
      width:200px; max-width:46vw; height:auto;
      border-radius:14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      padding:10px;
    }
    .hTitle{margin:0; font-size:19px; font-weight:1000; letter-spacing:.2px}
    .subtitle{color:var(--muted); font-size:13px; margin-top:6px; line-height:1.45}
    .subtitle b{color:var(--text)}
    .hours{
      margin-top:8px;
      display:flex; flex-direction:column; gap:6px;
      font-size:13px; font-weight:1000;
    }
    .hours .line{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .hours .tag{
      font-size:11px; font-weight:1000;
      padding:5px 9px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.92);
    }
    .hours .time{
      font-family: var(--mono);
      font-size:13px;
      color: rgba(255,255,255,.92);
    }

    .topActions{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end;}

    .btn{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:var(--text);
      padding:9px 11px;
      border-radius:12px;
      cursor:pointer;
      transition:.15s transform, .15s background, .15s border;
      display:inline-flex; gap:8px; align-items:center;
      user-select:none;
      box-shadow: 0 8px 20px rgba(0,0,0,.18);
      font-size:13px;
      white-space:nowrap;
      text-decoration:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.16)}
    .btn.primary{background: linear-gradient(135deg, rgba(255,213,74,.18), rgba(86,200,255,.12)); border-color: rgba(255,213,74,.35);}
    .btn.ok{border-color: rgba(66,211,155,.40)}
    .btn.danger{border-color: rgba(255,92,122,.35)}
    .btn.small{padding:8px 10px; border-radius:12px; font-size:12px;}
    .btn.ghost{background: rgba(255,255,255,.04);}

    .pill{
      font-size:11px; color:var(--muted);
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;
      padding:5px 9px;
      background: rgba(255,255,255,.04);
      display:inline-flex; gap:8px; align-items:center;
    }
    .mono{font-family:var(--mono)}

    .panel{
      background: rgba(16,24,39,.78);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .tabsWrap{padding:10px 12px 8px; border-bottom:1px solid rgba(255,255,255,.08);}
    .tabs{display:flex; gap:8px; overflow:auto; padding-bottom:4px; scrollbar-width: thin;}
    .tab{
      flex:0 0 auto;
      padding:8px 11px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      cursor:pointer;
      font-size:12px;
      color:var(--text);
      user-select:none;
      white-space:nowrap;
    }
    .tab.active{border-color: rgba(255,213,74,.35); background: rgba(255,213,74,.10);}

    .toolbar{
      padding:10px 12px 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:end;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .field label{display:block; font-size:11px; color:var(--muted); margin:0 0 6px 2px;}
    .input{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(11,15,23,.55);
      color:var(--text);
      padding:10px 11px;
      outline:none;
      font-size:13px;
    }
    .input::placeholder{color: rgba(168,179,199,.65)}
    .content{padding:12px;}

    .card{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(15,26,43,.92), rgba(15,26,43,.72));
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(350px 120px at 20% 0%, rgba(255,213,74,.18), transparent 70%),
        radial-gradient(300px 150px at 90% 0%, rgba(86,200,255,.14), transparent 65%);
      pointer-events:none;
      opacity:.65;
    }
    .cardInner{position:relative; padding:12px;}

    .badge{
      font-size:11px;
      padding:6px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--text);
      white-space:nowrap;
    }
    .badge.accent{border-color: rgba(255,213,74,.35)}
    .badge.blue{border-color: rgba(86,200,255,.35)}
    .badge.ok{border-color: rgba(66,211,155,.35)}
    .tiny{font-size:11px; color:rgba(168,179,199,.78)}

    .itemList{display:flex; flex-direction:column; gap:9px;}
    .itemCard{
      display:grid;
      grid-template-columns: 70px 1fr auto;
      gap:10px;
      align-items:center;
      padding:10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,15,23,.32);
    }
    .itemCard.noThumb{grid-template-columns: 1fr auto;}

    .thumb{
      width:62px; height:62px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.22);
      background: rgba(255,255,255,.05);
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      position:relative;
    }
    .thumb img{width:100%; height:100%; object-fit:cover; display:block;}
    .thumb .ph{
      font-weight:1000;
      color: rgba(255,255,255,.75);
      font-size:12px;
      letter-spacing:.5px;
      text-align:center;
      padding:6px;
      line-height:1.1;
      user-select:none;
    }
    .thumb .editDot{
      display:none;
      position:absolute;
      right:6px; bottom:6px;
      width:18px; height:18px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.35);
      align-items:center; justify-content:center;
      font-size:12px;
      color:#fff;
    }
    .thumb.admin .editDot{display:flex;}
    .thumb.admin::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.22));
      pointer-events:none;
    }

    .itemMain{min-width:0;}
    .itemName{font-weight:1000; font-size:13px; line-height:1.25;}
    .itemMeta{margin-top:4px; font-size:11px; color: rgba(168,179,199,.90); line-height:1.35;}
    .itemPrice{text-align:right; font-weight:1000; white-space:nowrap;}
    .itemPrice .unit{display:block; font-size:11px; color: rgba(168,179,199,.90); font-weight:900; margin-top:2px;}

    .acc{
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
      margin:9px 0;
    }
    .accHead{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; padding:9px 11px;
      cursor:pointer; user-select:none;
      background: rgba(255,255,255,.03);
    }
    .accTitleRow{display:flex; gap:10px; align-items:center;}
    .accTitle{font-weight:1000; font-size:13px;}
    .accArrow{opacity:.8; transition:.15s transform;}
    .accBody{padding:9px 11px 11px; border-top:1px solid rgba(255,255,255,.08);}
    .acc.collapsed .accBody{display:none;}
    .acc.collapsed .accArrow{transform: rotate(-90deg);}

    /* ===== Cabang Panel (compact) ===== */
    .branchPanel{
      display:none;
      margin-top:10px;
      padding:10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(11,15,23,.35);
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      backdrop-filter: blur(8px);
    }
    .branchPanel.show{display:block;}
    .branchGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px;
    }
    .branchCard{
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .branchName{font-size:14px; font-weight:1000;}
    .branchAddr{font-size:12px; color: rgba(168,179,199,.92); line-height:1.35;}
    .branchPhone{font-family:var(--mono); font-weight:1000; font-size:12px;}
    .branchActions{display:flex; gap:8px; flex-wrap:wrap;}

    /* ===== Admin login compact ===== */
    .adminLogin{
      display:none;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .adminLogin.show{display:flex;}
    .adminLogin .pw{
      width:min(180px, 60vw);
      padding:9px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(11,15,23,.55);
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    .adminTools{display:none; gap:8px; flex-wrap:wrap; align-items:center;}
    .adminTools.show{display:flex;}

    @media (max-width: 980px){
      header{flex-direction:column; align-items:stretch}
      .topActions{justify-content:flex-start}
      .logoImg{width:min(320px, 100%)}
      .branchGrid{grid-template-columns: 1fr;}
    }
    @media (max-width: 720px){
      .wrap{padding:12px 12px 18px;}
      .itemCard{
        grid-template-columns: 64px 1fr;
        grid-template-areas:
          "thumb main"
          "thumb price";
        align-items:start;
      }
      .itemCard.noThumb{
        grid-template-columns: 1fr;
        grid-template-areas:
          "main"
          "price";
      }
      .itemCard .thumb{grid-area: thumb;}
      .itemCard .itemMain{grid-area: main;}
      .itemCard .itemPrice{grid-area: price; text-align:left; margin-top:6px;}
    }

    /* ===== Image Zoom Modal ===== */
    .imgModal{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      background: rgba(0,0,0,.82);
      backdrop-filter: blur(6px);
      z-index:9999;
    }
    .imgModal.show{display:flex;}
    .imgModalBox{
      max-width:min(980px, 96vw);
      width:100%;
      display:flex; flex-direction:column;
      gap:10px;
      align-items:center;
    }
    .imgModalImg{
      width:100%;
      max-height: 82vh;
      object-fit:contain;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
    }
    .imgModalHint{
      font-size:13px;
      font-weight:1000;
      color: rgba(255,255,255,.92);
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      user-select:none;
    }

    @media print{
      header .topActions, .toolbar, .pill, .tabsWrap, .branchPanel, .adminLogin, .adminTools{display:none !important}
      .imgModal{display:none !important;}
      body{background:#fff; color:#000}
      .panel{box-shadow:none; border:none}
      .card{break-inside:avoid; box-shadow:none; border:1px solid #ddd}
      .card::before{display:none}
      .wrap{max-width:none}
      .tiny{color:#444 !important}
      .badge{border-color:#bbb !important; color:#000 !important; background:#f5f5f5 !important}
      .logoImg{box-shadow:none !important; border-color:#ddd !important}
      .itemCard{border-color:#ddd !important; background:#fff !important}
      .thumb{border-color:#bbb !important}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img class="logoImg" alt="Spectrum" src="logo.png" />
        <div>
          <div class="hTitle">Spectrum Digital Printing | Copy Center</div>
          <div class="subtitle">
            <b>MULYOSARI</b><br>
            üìç Raya Mulyosari 95A<br>
            üì± WA: <span class="mono">0895382392099</span>
          </div>

          <div class="hours">
            <div class="line"><span class="tag">Jam buka normal</span><span class="time">06.30 ‚Äì 00.00</span></div>
            <div class="line"><span class="tag">Tanggal merah</span><span class="time">09.00 ‚Äì 00.00</span></div>
          </div>

          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
            <button class="btn" id="btnCabang">üè¨ Cabang</button>
            <span class="pill">Klik untuk lihat daftar cabang</span>
          </div>

          <div class="branchPanel" id="branchPanel">
            <div class="branchGrid" id="branchGrid"></div>
          </div>
        </div>
      </div>

      <div class="topActions">
        <span class="pill" id="todayPill">üìÖ</span>
        <a class="btn ok" id="btnWA" target="_blank" rel="noopener">üí¨ WhatsApp</a>
        <button class="btn primary" id="btnPrint">üñ®Ô∏è Print / Save PDF</button>

        <button class="btn" id="btnMode">üë§ Mode: Customer</button>

        <div class="adminLogin" id="adminLogin">
          <input class="pw" id="adminPw" type="password" placeholder="Password admin..." />
          <button class="btn small" id="btnAdminLogin">Login</button>
          <button class="btn small ghost" id="btnAdminCancel">Batal</button>
        </div>

        <div class="adminTools" id="adminTools">
          <button class="btn" id="btnExport">‚¨áÔ∏è Export JSON</button>
          <label class="btn" for="importFile" id="btnImportLabel">‚¨ÜÔ∏è Import JSON</label>
          <input id="importFile" type="file" accept="application/json" style="display:none" />
          <button class="btn danger" id="btnReset">‚Ü∫ Reset</button>
        </div>
      </div>
    </header>

    <section class="panel">
      <div class="tabsWrap">
        <div class="tabs" id="tabs"></div>
        <div class="tiny" style="margin-top:8px;">Search global: ketik untuk browsing <span class="mono">semua produk</span> dari semua tab.</div>
      </div>

      <div class="toolbar">
        <div class="field">
          <label>Search global</label>
          <input id="q" class="input" placeholder="contoh: AP260, vinyl, brosur A5, kiss cut, laminasi, pvc..." />
        </div>
      </div>

      <div class="content">
        <div id="main"></div>
      </div>
    </section>
  </div>

  <!-- Zoom Modal -->
  <div id="imgModal" class="imgModal" role="dialog" aria-modal="true" aria-label="Preview gambar">
    <div class="imgModalBox">
      <img id="imgModalImg" class="imgModalImg" alt="Preview">
      <div class="imgModalHint">Tekan dimanapun untuk menutup</div>
    </div>
  </div>

  <script>
    (function(){
      // =============================
      // ADMIN PASSWORD (ubah di sini)
      // =============================
      const ADMIN_PASSWORD = "123123123SPC";

      const STORAGE_KEY = "spectrum_catalog_compact_v20";
      const nf = new Intl.NumberFormat("id-ID");
      const rupiah = (n)=> "Rp " + nf.format(Number(n||0));
      const normalize = (s)=> (s||"").toString().toLowerCase().trim();
      const $ = (id)=>document.getElementById(id);

      function escapeHtml(str){
        return (str ?? "").toString()
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }
      function initialsFromLabel(label){
        const s = (label||"").trim().toUpperCase();
        if(!s) return "IMG";
        const parts = s.split(/\s+/).filter(Boolean);
        if(parts.length===1) return parts[0].slice(0,3);
        return (parts[0][0]||"") + (parts[1][0]||"") + (parts[2]?.[0]||"");
      }
      function isMobile(){ return window.matchMedia && window.matchMedia("(max-width: 720px)").matches; }

      // ===== Branches =====
      const branches = [
        { name:"Spectrum Pakuwon City",
          address:"Jalan Kalisari Permai 1 No. 103 Ruko Sandiego MR 2 No, 20, Kalisari, Kec. Mulyorejo, Surabaya, Jawa Timur 60112",
          wa:"0895-3823-97099" },
        { name:"Spectrum Nginden",
          address:"Ruko Manyar Garden Regency No. 27, Jl. Nginden Semolo No.101, Menur Pumpungan, Kec. Sukolilo, Surabaya, Jawa Timur 60118",
          wa:"0895-3823-91799" },
        { name:"Spectrum Darmo",
          address:"Jl. Raya Darmo Permai II No.56, Pradahkalikendal, Kec. Dukuhpakis, Surabaya, Jawa Timur 60187",
          wa:"0895-3931-07099" },
        { name:"Spectrum Prambanan",
          address:"Jl. Prambanan Lidah Kulon I No.Kel, Lidah Kulon, Kec. Lakarsantri, Surabaya, Jawa Timur 60213",
          wa:"0895-3971-00922" },
        { name:"Spectrum Wilis Malang",
          address:"Jl. Wilis No.37B, Gading Kasri, Kec. Klojen, Kota Malang, Jawa Timur 65115",
          wa:"0821-4255-2259" },
        { name:"Spectrum Aniva Tangerang",
          address:"Aniva Grande, Ruko No.7 Blok G2, Gading, Kec. Serpong, Kabupaten Tangerang, Banten 15334",
          wa:"081231642299" },
      ];
      function waToE164(wa){
        const digits = (wa||"").replace(/\D/g,"");
        if(!digits) return "";
        if(digits.startsWith("62")) return digits;
        if(digits.startsWith("0")) return "62" + digits.slice(1);
        return digits;
      }
      function renderBranches(){
        const grid = $("branchGrid");
        grid.innerHTML = "";
        branches.forEach(b=>{
          const waE164 = waToE164(b.wa);
          const card = document.createElement("div");
          card.className = "branchCard";
          card.innerHTML = `
            <div class="branchName">${escapeHtml(b.name)}</div>
            <div class="branchAddr">üìç ${escapeHtml(b.address)}</div>
            <div class="branchPhone">üì± ${escapeHtml(b.wa)}</div>
            <div class="branchActions">
              <a class="btn ok small" target="_blank" rel="noopener" href="https://wa.me/${waE164}">üí¨ WA</a>
              <button class="btn small ghost" type="button" data-copy="${escapeHtml(b.wa)}">üìã Copy</button>
            </div>
          `;
          grid.appendChild(card);
        });

        grid.querySelectorAll("[data-copy]").forEach(btn=>{
          btn.addEventListener("click", async ()=>{
            try{
              await navigator.clipboard.writeText(btn.getAttribute("data-copy") || "");
              btn.textContent = "‚úÖ";
              setTimeout(()=>btn.textContent="üìã Copy", 800);
            }catch(e){
              alert("Tidak bisa copy otomatis. Silakan copy manual ya.");
            }
          });
        });
      }

      // ===== Catalog Data =====
      const DESC = {
        HVS: "Kertas HVS (uncoated) matte/halus. Cocok dokumen & materi belajar. Warna natural (tidak se-glossy art paper).",
        HVS_A3_ONLY: "Cetak hanya per A3 (1 lembar A3 muat 2 lembar A4). ",
        AP: "Art Paper (coated) halus, warna lebih tajam. Cocok flyer, poster, menu, dsb.",
        AP120: "Ringan untuk brosur/flyer ekonomis.",
        AP150: "Lebih tebal dari 120, masih fleksibel untuk brosur.",
        AP210: "Tebal, cocok cover ringan / kartu / booklet tipis (enak kalau dilaminasi).",
        AP260: "Tebal, umum untuk kartu/cover.",
        AP310: "Lebih kaku, cocok kartu & cover premium.",
        AP400: "Sangat tebal/kaku, cocok kartu premium/display kecil.",
        JASMINE: "Kertas tekstur premium (feel elegan). Cocok undangan/kartu.",
        COPEN: "Kertas tekstur premium, cocok undangan/kartu premium.",
        BLUSH: "Kertas tekstur premium, tone elegan. Cocok undangan/kartu.",
        BONTak: "Stiker kertas (tidak tahan air). Permukaan matte/halus. Cocok label indoor; bisa dilaminasi agar lebih awet.",
        VINYL_WHITE: "Stiker vinyl putih (tahan air). Cocok label produk/outdoor ringan.",
        VINYL_CLEAR: "Stiker vinyl transparan (tahan air). Cocok efek bening pada kaca/kemasan.",
        VINYL_METAL: "Stiker vinyl metalik (silver/gold) untuk efek premium, terlihat mengkilap.",
        GLORY: "Kertas foto glossy untuk warna lebih pop & mengkilap.",
        PVC: "ID Card bahan PVC (mirip kartu ATM). Harga 1 sisi dan bolak-balik sama."
      };

      const DEFAULT_STATE = {
        ui:{ activeTab:"fotocopy", accOpen:{} },
        admin:{ isAdmin:false },
        thumbs:{} // key -> url
      };

      const CATALOG = {
        sections:[
          { key:"fotocopy", title:"Fotocopy", badge:{text:"Per sisi", style:"accent"}, sub:"Laser", type:"rows",
            rows:[
              {label:"A4 70 gram", price:300, unit:"sisi", desc:"Fotocopy standar untuk dokumen A4."},
              {label:"F4 70 gram", price:300, unit:"sisi", desc:"Fotocopy standar untuk ukuran F4/Folio."},
              {label:"A3 70 gram", price:600, unit:"sisi", desc:"Fotocopy ukuran besar A3."},
            ]},
          { key:"hitamputih", title:"Hitam Putih", badge:{text:"Per sisi", style:"accent"}, sub:"Laser", type:"rows",
            rows:[
              {label:"A4 70 gram", price:500, unit:"sisi", desc:"Hemat untuk dokumen teks."},
              {label:"A4 80 gram", price:550, unit:"sisi", desc:"Lebih tebal & rapi."},
              {label:"F4 70 gram", price:500, unit:"sisi", desc:"Ukuran folio/F4."},
              {label:"A3 70 gram", price:800, unit:"sisi", desc:"Cetak BW ukuran besar A3."},
              {label:"A3 80 gram", price:1000, unit:"sisi", desc:"A3 lebih tebal."},
              {label:"A3+ 80 gram", price:1800, unit:"sisi", desc:"A3+ area cetak lebih luas."},
              {label:"A3+ 100 gram", price:1800, unit:"sisi", desc:"A3+ lebih tebal."},
            ]},
          { key:"warna", title:"Warna", badge:{text:"Per sisi", style:"accent"}, sub:"Laser", type:"groupedRows",
            groups:[
              // HVS & Art Paper: thumbnail hanya di judul (headerThumb), TIDAK per produk (rowThumb=false)
              { title:"HVS", headerThumb:true, rowThumb:false, rows:[
                {label:"HVS A3 70 gram", price:2700, unit:"sisi", desc: DESC.HVS_A3_ONLY + DESC.HVS},
                {label:"HVS A3 80 gram", price:2700, unit:"sisi", desc: DESC.HVS},
                {label:"HVS A3+ 80 gram", price:2700, unit:"sisi", desc: "Versi A3+ area cetak lebih luas. " + DESC.HVS},
                {label:"HVS A3+ 100 gram", price:2700, unit:"sisi", desc: "Lebih tebal. " + DESC.HVS},
              ]},
              { title:"Art Paper", headerThumb:true, rowThumb:false, rows:[
                {label:"AP120 gram", price:2700, unit:"sisi", desc: DESC.AP + " " + DESC.AP120},
                {label:"AP150 gram", price:2800, unit:"sisi", desc: DESC.AP + " " + DESC.AP150},
                {label:"AP210 gram", price:3100, unit:"sisi", desc: DESC.AP + " " + DESC.AP210},
                {label:"AP260 gram", price:3300, unit:"sisi", desc: DESC.AP + " " + DESC.AP260},
                {label:"AP310 gram", price:4000, unit:"sisi", desc: DESC.AP + " " + DESC.AP310},
                {label:"AP400 gram", price:7500, unit:"sisi", desc: DESC.AP + " " + DESC.AP400},
              ]},

              // Selain HVS & Art Paper: thumbnail per produk (rowThumb=true)
              { title:"Kertas Tekstur", headerThumb:false, rowThumb:true, rows:[
                {label:"Jasmine 220 gram", price:4300, unit:"sisi", desc: DESC.JASMINE},
                {label:"Copenhagen 220 gram", price:4300, unit:"sisi", desc: DESC.COPEN},
                {label:"Blushwhite 270 gram", price:4300, unit:"sisi", desc: DESC.BLUSH},
              ]},
              { title:"Stiker", headerThumb:false, rowThumb:true, rows:[
                {label:"Bontak (Tidak Anti Air)", price:4000, unit:"sisi", desc: DESC.BONTak},
                {label:"Vinyl Putih (Tahan Air)", price:8000, unit:"sisi", desc: DESC.VINYL_WHITE},
                {label:"Vinyl Transparan (Tahan Air)", price:8000, unit:"sisi", desc: DESC.VINYL_CLEAR},
                {label:"Vinyl Metalik (Silver/Gold)", price:12000, unit:"sisi", desc: DESC.VINYL_METAL},
              ]},
              { title:"ID Card PVC", headerThumb:false, rowThumb:true, rows:[
                {label:"ID Card PVC (Paket 2 pcs)", price:20000, unit:"paket", desc: DESC.PVC + " (Hitungan per 2 pcs)."},
                {label:"ID Card PVC (Paket 5 pcs)", price:37500, unit:"paket", desc: DESC.PVC + " (Hitungan per 5 pcs)."},
              ]},
              { title:"Lainnya", headerThumb:false, rowThumb:true, rows:[
                {label:"Glory A4", price:6000, unit:"sisi", desc: DESC.GLORY},
              ]},
            ]},

          { key:"kartunama", title:"Kartu Nama (1 box=100pcs ‚Ä¢ 9√ó5,5 cm)", badge:{text:"Per box", style:"blue"}, sub:"Laser", type:"rows2price",
            rows:[
              {label:"AP 260", p1:22000, p2:44000, desc:"Art Paper 260g, tebal untuk kartu."},
              {label:"AP 310", p1:27000, p2:54000, desc:"Art Paper 310g, lebih kaku/premium."},
              {label:"Blushwhite", p1:27000, p2:54000, desc:"Tekstur premium."},
              {label:"Copenhagen", p1:27000, p2:54000, desc:"Tekstur premium."},
              {label:"Jasmine", p1:27000, p2:54000, desc:"Tekstur premium."},
            ],
            extras:[
              {label:"Tambah Kotak", price:3000, unit:"pcs", desc:"Kotak kartu nama."},
              {label:"Laminasi (1 box) 1 sisi", price:16000, unit:"box", desc:"Laminasi doff/glossy 1 sisi."},
              {label:"Laminasi (1 box) 2 sisi", price:32000, unit:"box", desc:"Laminasi doff/glossy 2 sisi."},
            ]},

          { key:"brosur_1sisi", title:"Paket Brosur 1 Rim (1 sisi)", badge:{text:"Per rim", style:"ok"}, sub:"Laser", type:"rows",
            rows:[
              {label:"A6 ‚Ä¢ Artpaper 120", price:150000, unit:"rim", desc:"Brosur A6 ekonomis."},
              {label:"A6 ‚Ä¢ Artpaper 150", price:165000, unit:"rim", desc:"A6 lebih tebal."},
              {label:"A6 ‚Ä¢ HVS100", price:150000, unit:"rim", desc:"A6 HVS 100g."},
              {label:"A5 ‚Ä¢ Artpaper 120", price:265000, unit:"rim", desc:"A5 ekonomis."},
              {label:"A5 ‚Ä¢ Artpaper 150", price:280000, unit:"rim", desc:"A5 lebih tebal."},
              {label:"A5 ‚Ä¢ HVS100", price:265000, unit:"rim", desc:"A5 HVS 100g."},
              {label:"A4 ‚Ä¢ Artpaper 120", price:520000, unit:"rim", desc:"A4 ekonomis."},
              {label:"A4 ‚Ä¢ Artpaper 150", price:535000, unit:"rim", desc:"A4 lebih tebal."},
              {label:"A4 ‚Ä¢ HVS100", price:520000, unit:"rim", desc:"A4 HVS 100g."},
            ]},
          { key:"brosur_2sisi", title:"Paket Brosur 1 Rim (2 sisi)", badge:{text:"Per rim", style:"ok"}, sub:"Laser", type:"rows",
            rows:[
              {label:"A6 ‚Ä¢ Artpaper 120", price:265000, unit:"rim", desc:"A6 bolak-balik."},
              {label:"A6 ‚Ä¢ Artpaper 150", price:280000, unit:"rim", desc:"A6 lebih tebal."},
              {label:"A6 ‚Ä¢ HVS100", price:265000, unit:"rim", desc:"A6 HVS 100g."},
              {label:"A5 ‚Ä¢ Artpaper 120", price:535000, unit:"rim", desc:"A5 bolak-balik."},
              {label:"A5 ‚Ä¢ Artpaper 150", price:550000, unit:"rim", desc:"A5 lebih tebal."},
              {label:"A5 ‚Ä¢ HVS100", price:535000, unit:"rim", desc:"A5 HVS 100g."},
              {label:"A4 ‚Ä¢ Artpaper 120", price:950000, unit:"rim", desc:"A4 bolak-balik."},
              {label:"A4 ‚Ä¢ Artpaper 150", price:1000000, unit:"rim", desc:"A4 lebih tebal."},
              {label:"A4 ‚Ä¢ HVS100", price:950000, unit:"rim", desc:"A4 HVS 100g."},
            ]},

          { key:"laminasi_a3", title:"Laminasi", headerThumb:true, badge:{text:"Add-on", style:"blue"}, sub:"Per sisi ‚Ä¢ Laser", type:"rows",
            rows:[{label:"Laminasi A3 (Glossy/Doff)", price:4000, unit:"sisi", desc:"Hanya untuk Art Paper ¬± AP210 ke atas & bahan stiker. Glossy mengkilap, doff matte/elegan."}]},

          { key:"laminating", title:"Laminating", headerThumb:true, badge:{text:"Add-on", style:"blue"}, sub:"Laser", type:"rows",
            rows:[
              {label:"Laminating F4", price:5000, unit:"lembar", desc:"Laminating ukuran F4."},
              {label:"Laminating A3", price:10000, unit:"lembar", desc:"Laminating ukuran A3."},
            ]},

          { key:"cutting", title:"Jasa Cutting (per lembar A3)", badge:{text:"Add-on", style:"blue"}, sub:"Maks 3 desain/gambar per lembar", type:"groupedRows",
            groups:[
              { title:"Kiss Cut (setengah putus)", headerThumb:true, rowThumb:false, rows:[
                {label:"S ‚Ä¢ 1 ‚Äì 45 pcs", price:4500, unit:"lembar", desc:"Kiss cut: potong stiker saja, backing tetap utuh."},
                {label:"M ‚Ä¢ 46 ‚Äì 90 pcs", price:7500, unit:"lembar", desc:"Kiss cut ukuran M."},
                {label:"L ‚Ä¢ 91 ‚Äì 135 pcs", price:12000, unit:"lembar", desc:"Kiss cut ukuran L."},
                {label:"XL ‚Ä¢ 136 ‚Äì 200 pcs", price:20000, unit:"lembar", desc:"Kiss cut ukuran XL."},
                {label:"XXL ‚Ä¢ 201 ‚Äì 300 pcs", price:35000, unit:"lembar", desc:"Kiss cut ukuran XXL."},
                {label:"3XL ‚Ä¢ 301 ‚Äì 500 pcs", price:50000, unit:"lembar", desc:"Kiss cut ukuran 3XL."},
                {label:"4XL ‚Ä¢ 501 ‚Äì 1000 pcs", price:100000, unit:"lembar", desc:"Kiss cut ukuran 4XL."},
              ]},
              { title:"Die Cut (cutting putus)", headerThumb:true, rowThumb:false, rows:[
                {label:"S ‚Ä¢ 1 ‚Äì 45 pcs", price:5000, unit:"lembar", desc:"Die cut: potong sampai putus termasuk backing."},
                {label:"M ‚Ä¢ 46 ‚Äì 90 pcs", price:10000, unit:"lembar", desc:"Die cut ukuran M."},
                {label:"L ‚Ä¢ 91 ‚Äì 135 pcs", price:15000, unit:"lembar", desc:"Die cut ukuran L."},
                {label:"XL ‚Ä¢ 136 ‚Äì 200 pcs", price:25000, unit:"lembar", desc:"Die cut ukuran XL."},
                {label:"XXL ‚Ä¢ 201 ‚Äì 300 pcs", price:35000, unit:"lembar", desc:"Die cut ukuran XXL."},
              ]},
            ]},

          { key:"jilid", title:"Macam-macam Jilid", badge:{text:"Info", style:"blue"}, sub:"Harga menyesuaikan ketebalan/jumlah halaman", type:"textRows",
            rows:[
              {label:"Spiral", text:"Rp 6.000 ‚Äì 28.000", desc:"Cocok untuk notes/buku kerja (bisa dibuka 360¬∞)."},
              {label:"Lakban", text:"Rp 4.000 ‚Äì 15.000", desc:"Jilid cepat & rapi, kuat sesuai tebal."},
              {label:"Mika", text:"Rp 1.000 / lembar", desc:"Cover transparan (depan/back)."},
              {label:"Bufalo", text:"Rp 1.000 / lembar", desc:"Cover doff/tekstur lebih kokoh."},
              {label:"Softcover", text:"Rp 20.500 ‚Äì 50.000", desc:"Cover fleksibel seperti buku, harga sesuai tebal."},
              {label:"Hardcover", text:"Rp 35.000", desc:"Cover keras premium."},
            ]},
        ]
      };

      const TAB_ORDER = [
        {key:"fotocopy", title:"Fotocopy"},
        {key:"hitamputih", title:"Hitam Putih"},
        {key:"warna", title:"Warna"},
        {key:"kartunama", title:"Kartu Nama"},
        {key:"brosur_1sisi", title:"Brosur 1 sisi"},
        {key:"brosur_2sisi", title:"Brosur 2 sisi"},
        {key:"laminasi_a3", title:"Laminasi"},
        {key:"laminating", title:"Laminating"},
        {key:"cutting", title:"Cutting"},
        {key:"jilid", title:"Jilid"},
      ];

      function deepClone(x){ return JSON.parse(JSON.stringify(x)); }
      function loadState(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          if(!raw) return deepClone(DEFAULT_STATE);
          const obj = JSON.parse(raw);
          if(!obj.ui) obj.ui = deepClone(DEFAULT_STATE.ui);
          if(!obj.admin) obj.admin = deepClone(DEFAULT_STATE.admin);
          if(!obj.thumbs) obj.thumbs = {};
          if(!obj.ui.accOpen) obj.ui.accOpen = {};
          if(!obj.ui.activeTab) obj.ui.activeTab = "fotocopy";
          return obj;
        }catch(e){
          return deepClone(DEFAULT_STATE);
        }
      }
      function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

      let state = loadState();

      // ===== Thumbnail key helpers =====
      function kSectionHead(sectionKey){ return `shead::${sectionKey}`; }
      function kGroupHead(sectionKey, groupTitle){ return `ghead::${sectionKey}::${groupTitle}`; }
      function kRow(sectionKey, groupTitle, rowLabel){ return `row::${sectionKey}::${groupTitle}::${rowLabel}`; }
      function getThumbUrl(key){ return (state.thumbs && state.thumbs[key]) ? state.thumbs[key] : ""; }

      function thumbBoxHtml(title, imgUrl, key){
        const url = imgUrl || getThumbUrl(key);
        const cls = state.admin.isAdmin ? "thumb admin" : "thumb";
        const dataKey = key ? `data-thumb-key="${escapeHtml(key)}"` : "";
        if(url){
          return `<div class="${cls}" ${dataKey}><img src="${escapeHtml(url)}" alt=""><div class="editDot">‚úé</div></div>`;
        }
        return `<div class="${cls}" ${dataKey}><div class="ph">${escapeHtml(title || "IMG")}</div><div class="editDot">‚úé</div></div>`;
      }
      function rowThumbHtml(label, key, fallbackImg){
        const url = getThumbUrl(key) || (fallbackImg||"");
        const cls = state.admin.isAdmin ? "thumb admin" : "thumb";
        const dataKey = `data-thumb-key="${escapeHtml(key)}"`;
        if(url){
          return `<div class="${cls}" ${dataKey}><img src="${escapeHtml(url)}" alt=""><div class="editDot">‚úé</div></div>`;
        }
        return `<div class="${cls}" ${dataKey}><div class="ph">${escapeHtml(initialsFromLabel(label))}</div><div class="editDot">‚úé</div></div>`;
      }

      // ===== Zoom Modal =====
      const imgModal = $("imgModal");
      const imgModalImg = $("imgModalImg");
      function lockScroll(lock){
        document.documentElement.style.overflow = lock ? "hidden" : "";
        document.body.style.overflow = lock ? "hidden" : "";
      }
      function openImgModal(src){
        if(!src) return;
        imgModalImg.src = src;
        imgModal.classList.add("show");
        lockScroll(true);
      }
      function closeImgModal(){
        imgModal.classList.remove("show");
        imgModalImg.src = "";
        lockScroll(false);
      }
      imgModal.addEventListener("click", closeImgModal);
      document.addEventListener("keydown", (e)=>{
        if(e.key === "Escape" && imgModal.classList.contains("show")) closeImgModal();
      });

      // Click thumbnail:
      // - Customer: zoom gambar (kalau ada URL)
      // - Admin: prompt ganti URL thumbnail
      document.addEventListener("click", (e)=>{
        const t = e.target.closest(".thumb[data-thumb-key]");
        if(!t) return;
        const key = t.getAttribute("data-thumb-key");
        if(!key) return;

        if(state.admin.isAdmin){
          e.preventDefault();
          e.stopPropagation();
          const current = getThumbUrl(key) || "";
          const next = prompt(
            "Masukkan URL gambar thumbnail.\n\n‚Ä¢ OK = simpan\n‚Ä¢ Kosongkan lalu OK = hapus\n",
            current
          );
          if(next === null) return;
          const trimmed = (next||"").trim();
          if(trimmed){
            state.thumbs[key] = trimmed;
          }else{
            delete state.thumbs[key];
          }
          saveState();
          render();
          return;
        }

        // customer mode -> zoom kalau ada img
        const img = t.querySelector("img");
        if(img && img.getAttribute("src")){
          e.preventDefault();
          e.stopPropagation();
          openImgModal(img.getAttribute("src"));
        }
      });

      // ===== Render helpers =====
      function badgeHtml(b){
        const cls = b?.style ? `badge ${b.style}` : "badge";
        return `<span class="${cls}">${escapeHtml(b?.text||"")}</span>`;
      }
      function accKey(sectionKey, groupTitle){ return `${sectionKey}::${groupTitle}`; }

      function sectionHeaderHtml(section){
        const hasThumb = !!section.headerThumb;
        const key = kSectionHead(section.key);
        return `
          <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px; margin:4px 0 10px 0;">
            <div style="display:flex; gap:10px; align-items:center;">
              ${hasThumb ? thumbBoxHtml(section.title, "", key) : ""}
              <div>
                <div style="font-weight:1000; font-size:14px;">${escapeHtml(section.title)}</div>
                <div class="tiny">${escapeHtml(section.sub||"")}</div>
              </div>
            </div>
            ${section.badge ? badgeHtml(section.badge) : ""}
          </div>
        `;
      }

      function renderRows(rows){
        let html = `<div class="itemList">`;
        rows.forEach((r)=>{
          html += `
            <div class="itemCard noThumb">
              <div class="itemMain">
                <div class="itemName">${escapeHtml(r.label)}</div>
                <div class="itemMeta">${escapeHtml(r.desc||"")}</div>
              </div>
              <div class="itemPrice">${rupiah(r.price)}<span class="unit">/ ${escapeHtml(r.unit||"")}</span></div>
            </div>
          `;
        });
        html += `</div>`;
        return html;
      }

      function renderTextRows(rows){
        let html = `<div class="itemList">`;
        rows.forEach((r)=>{
          // Jilid: thumbnail per produk (user minta)
          const key = `jilid::${r.label}`;
          html += `
            <div class="itemCard">
              ${rowThumbHtml(r.label, key, "")}
              <div class="itemMain">
                <div class="itemName">${escapeHtml(r.label)}</div>
                <div class="itemMeta">${escapeHtml(r.desc || r.text || "")}</div>
              </div>
              <div class="itemPrice"><span class="unit">${escapeHtml(r.text||"")}</span></div>
            </div>
          `;
        });
        html += `</div>`;
        return html;
      }

      function renderRows2price(section, q){
        const match = (obj)=> !q || normalize(JSON.stringify(obj)).includes(q);
        let html = `<div class="itemList">`;
        (section.rows||[]).forEach((r)=>{
          if(q && !match(r)) return;
          html += `
            <div class="itemCard noThumb">
              <div class="itemMain">
                <div class="itemName">${escapeHtml(r.label)}</div>
                <div class="itemMeta">${escapeHtml(r.desc||"")}</div>
              </div>
              <div class="itemPrice">${rupiah(r.p1)} ‚Ä¢ ${rupiah(r.p2)}<span class="unit">/ box</span></div>
            </div>
          `;
        });
        html += `</div>`;

        if(section.extras?.length){
          html += `<div class="tiny" style="margin:10px 0 6px 0;"><b>Tambahan</b></div>`;
          html += `<div class="itemList">`;
          section.extras.forEach((ex)=>{
            if(q && !match(ex)) return;

            // thumbnail khusus "kotak" (tetap boleh), lainnya noThumb
            const isKotak = normalize(ex.label).includes("kotak");
            const key = `kartunama-extra::${ex.label}`;
            html += `
              <div class="itemCard${isKotak ? "" : " noThumb"}">
                ${isKotak ? rowThumbHtml(ex.label, key, "") : ""}
                <div class="itemMain">
                  <div class="itemName">${escapeHtml(ex.label)}</div>
                  <div class="itemMeta">${escapeHtml(ex.desc||"")}</div>
                </div>
                <div class="itemPrice">${rupiah(ex.price)}<span class="unit">/ ${escapeHtml(ex.unit||"")}</span></div>
              </div>
            `;
          });
          html += `</div>`;
        }

        return html;
      }

      function renderGrouped(section, q){
        const match = (obj)=> !q || normalize(JSON.stringify(obj)).includes(q);
        state.ui.accOpen = state.ui.accOpen || {};
        let html = "";

        section.groups.forEach((g)=>{
          const accK = accKey(section.key, g.title);
          if(state.ui.accOpen[accK] === undefined) state.ui.accOpen[accK] = !isMobile();
          const collapsed = !state.ui.accOpen[accK];

          const rowsFiltered = (g.rows||[]).filter(match);
          if(q && !rowsFiltered.length) return;

          const gHeadKey = kGroupHead(section.key, g.title);

          html += `
            <div class="acc ${collapsed ? "collapsed":""}">
              <div class="accHead" data-acc-key="${escapeHtml(accK)}">
                <div class="accTitleRow">
                  ${g.headerThumb ? thumbBoxHtml(g.title, "", gHeadKey) : ""}
                  <div class="accTitle">${escapeHtml(g.title)}</div>
                </div>
                <div class="accArrow">‚ñæ</div>
              </div>
              <div class="accBody">
                <div class="itemList">
          `;

          (q ? rowsFiltered : (g.rows||[])).forEach((r)=>{
            const rowKey = kRow(section.key, g.title, r.label);

            if(g.rowThumb){
              // thumbnail PER PRODUK
              html += `
                <div class="itemCard">
                  ${rowThumbHtml(r.label, rowKey, r.img || "")}
                  <div class="itemMain">
                    <div class="itemName">${escapeHtml(r.label)}</div>
                    <div class="itemMeta">${escapeHtml(r.desc || g.title)}</div>
                  </div>
                  <div class="itemPrice">${rupiah(r.price)}<span class="unit">/ ${escapeHtml(r.unit||"")}</span></div>
                </div>
              `;
            }else{
              // TANPA thumbnail per produk
              html += `
                <div class="itemCard noThumb">
                  <div class="itemMain">
                    <div class="itemName">${escapeHtml(r.label)}</div>
                    <div class="itemMeta">${escapeHtml(r.desc || g.title)}</div>
                  </div>
                  <div class="itemPrice">${rupiah(r.price)}<span class="unit">/ ${escapeHtml(r.unit||"")}</span></div>
                </div>
              `;
            }
          });

          html += `</div></div></div>`;
        });

        return html || `<div class="tiny">Tidak ada data.</div>`;
      }

      function render(){
        const q = normalize($("q").value);
        const main = $("main");
        main.innerHTML = "";

        // GLOBAL SEARCH
        if(q){
          const card = document.createElement("div");
          card.className = "card";
          let html = `
            <div class="cardInner">
              <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px; margin:4px 0 10px 0;">
                <div>
                  <div style="font-weight:1000; font-size:14px;">Hasil Search</div>
                  <div class="tiny">Menampilkan hasil dari semua tab untuk: <span class="mono">${escapeHtml(q)}</span></div>
                </div>
                <span class="badge accent">Global</span>
              </div>
          `;

          let found = false;
          CATALOG.sections.forEach(sec=>{
            const any = normalize(JSON.stringify(sec)).includes(q);
            if(!any) return;
            found = true;

            html += sectionHeaderHtml(sec);

            if(sec.type === "rows") html += renderRows((sec.rows||[]).filter(r=>normalize(JSON.stringify(r)).includes(q)));
            else if(sec.type === "groupedRows") html += renderGrouped(sec, q);
            else if(sec.type === "rows2price") html += renderRows2price(sec, q);
            else if(sec.type === "textRows") html += renderTextRows((sec.rows||[]).filter(r=>normalize(JSON.stringify(r)).includes(q)));

            html += `<div style="height:10px"></div>`;
          });

          if(!found) html += `<div class="tiny">Tidak ada hasil yang cocok.</div>`;
          html += `</div>`;
          card.innerHTML = html;
          main.appendChild(card);
          wireAccClicks(); // rebind accordion
          return;
        }

        // TAB MODE
        const active = CATALOG.sections.find(s=>s.key===state.ui.activeTab) || CATALOG.sections[0];
        const card = document.createElement("div");
        card.className = "card";

        let body = sectionHeaderHtml(active);

        if(active.type === "rows") body += renderRows(active.rows||[]);
        else if(active.type === "groupedRows") body += renderGrouped(active, "");
        else if(active.type === "rows2price") body += renderRows2price(active, "");
        else if(active.type === "textRows") body += renderTextRows(active.rows||[]);

        card.innerHTML = `<div class="cardInner">${body}</div>`;
        main.appendChild(card);
        wireAccClicks(); // rebind accordion
      }

      function wireAccClicks(){
        document.querySelectorAll(".accHead[data-acc-key]").forEach(h=>{
          h.onclick = ()=>{
            const k = h.getAttribute("data-acc-key");
            state.ui.accOpen[k] = !state.ui.accOpen[k];
            saveState();
            render();
          };
        });
      }

      function renderTabs(){
        const tabs = $("tabs");
        tabs.innerHTML = "";
        TAB_ORDER.forEach(t=>{
          const el = document.createElement("div");
          el.className = "tab" + (t.key===state.ui.activeTab ? " active" : "");
          el.textContent = t.title;
          el.onclick = ()=>{
            state.ui.activeTab = t.key;
            saveState();
            renderTabs();
            render();
          };
          tabs.appendChild(el);
        });
      }

      // ===== Admin UI =====
      function setAdminUI(){
        const isAdmin = !!state.admin.isAdmin;
        $("btnMode").textContent = isAdmin ? "üõ†Ô∏è Mode: Admin" : "üë§ Mode: Customer";
        $("adminTools").classList.toggle("show", isAdmin);
        // kalau admin, tutup panel login
        if(isAdmin){
          $("adminLogin").classList.remove("show");
          $("adminPw").value = "";
        }
      }

      function exportJSON(){
        const payload = {
          version: 1,
          exportedAt: new Date().toISOString(),
          state: state
        };
        const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "spectrum-katalog-backup.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      function importJSON(file){
        const reader = new FileReader();
        reader.onload = ()=>{
          try{
            const obj = JSON.parse(reader.result);
            if(obj?.state){
              // merge aman
              const next = obj.state;
              if(!next.ui) next.ui = deepClone(DEFAULT_STATE.ui);
              if(!next.admin) next.admin = deepClone(DEFAULT_STATE.admin);
              if(!next.thumbs) next.thumbs = {};
              state = next;
              saveState();
              setAdminUI();
              renderTabs();
              render();
              alert("Import berhasil.");
            }else{
              alert("Format JSON tidak sesuai.");
            }
          }catch(e){
            alert("Gagal import JSON.");
          }
        };
        reader.readAsText(file);
      }

      // ===== Wire UI =====
      function wireUI(){
        // top
        $("btnPrint").onclick = ()=>window.print();
        $("btnCabang").onclick = ()=>{
          const panel = $("branchPanel");
          panel.classList.toggle("show");
          if(panel.classList.contains("show")) panel.scrollIntoView({behavior:"smooth", block:"nearest"});
        };
        $("q").oninput = render;

        // mode button
        $("btnMode").onclick = ()=>{
          if(state.admin.isAdmin){
            // logout
            if(confirm("Keluar dari mode Admin?")){
              state.admin.isAdmin = false;
              saveState();
              setAdminUI();
              render(); // supaya badge editDot hilang
            }
            return;
          }
          // show login panel
          $("adminLogin").classList.toggle("show");
          if($("adminLogin").classList.contains("show")) $("adminPw").focus();
        };

        $("btnAdminCancel").onclick = ()=>{
          $("adminLogin").classList.remove("show");
          $("adminPw").value = "";
        };

        $("btnAdminLogin").onclick = ()=>{
          const pw = ($("adminPw").value || "").trim();
          if(pw === ADMIN_PASSWORD){
            state.admin.isAdmin = true;
            saveState();
            setAdminUI();
            render(); // tampilkan editDot di thumbnail
          }else{
            alert("Password salah.");
            $("adminPw").focus();
          }
        };

        $("adminPw").addEventListener("keydown", (e)=>{
          if(e.key === "Enter") $("btnAdminLogin").click();
        });

        // admin tools
        $("btnExport").onclick = exportJSON;
        $("importFile").onchange = (e)=>{
          const f = e.target.files && e.target.files[0];
          if(f) importJSON(f);
          e.target.value = "";
        };
        $("btnReset").onclick = ()=>{
          if(confirm("Reset semua setting thumbnail & mode?")){
            localStorage.removeItem(STORAGE_KEY);
            state = loadState();
            setAdminUI();
            renderTabs();
            render();
          }
        };

        // WA default
        $("btnWA").href = "https://wa.me/62895382392099";
      }

      function initTop(){
        const d = new Date();
        const fmt = new Intl.DateTimeFormat("id-ID", { weekday:"long", year:"numeric", month:"long", day:"numeric" });
        $("todayPill").textContent = "üìÖ " + fmt.format(d);
      }

      // ===== Start =====
      initTop();
      renderBranches();
      renderTabs();
      wireUI();
      setAdminUI();
      render();
    })();
  </script>
</body>
</html>